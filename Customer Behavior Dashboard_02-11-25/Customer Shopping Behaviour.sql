SELECT * FROM customer_behaviour.customer;

-- Q1 : What is the total revenue generated by male vs. female customers?
SELECT 
    gender, SUM(purchase_amount) AS revenue
FROM
    customer
GROUP BY gender;





-- Q2 : Which customers used a discount but still spend more than the average purchase amount?
SELECT 
    discount_applied, purchase_amount
FROM
    customer
WHERE
    (discount_applied = 'Yes')
        AND (purchase_amount >= (SELECT 
            AVG(purchase_amount)
        FROM
            customer));





-- Q3 : Which are the Top 5 Products with the highest average review rating?
SELECT 
    item_purchased,
    AVG(review_rating) AS 'Average Review Rating'
FROM
    customer
GROUP BY item_purchased
ORDER BY AVG(review_rating) DESC
LIMIT 5;





-- Q4 : Compare the average purchase amounts between Standard and Express Shipping.
SELECT 
    shipping_type,
    AVG(purchase_amount) AS 'Average Purchase Amount'
FROM
    customer
GROUP BY shipping_type
HAVING (shipping_type = 'Express')
    OR (shipping_type = 'Standard');

    



-- Q5 : Do subscribed customer spend more?
-- Compare average spend and total revenue between subscribers and non-subscribers.
SELECT 
    subscription_status,
    COUNT(customer_id) AS 'Total customer',
    SUM(purchase_amount) AS Revenue,
    AVG(purchase_amount) AS 'Average Spend'
FROM
    customer
GROUP BY subscription_status
ORDER BY Revenue DESC;





-- Q6 : Which 5 products have the highest percentage purchases with discount applied?
SELECT 
    item_purchased,
    COUNT(*) AS total_purchases,
    SUM(CASE
        WHEN discount_applied = 'Yes' THEN 1
        ELSE 0
    END) AS discount_purchased,
    (SUM(CASE
        WHEN discount_applied = 'Yes' THEN 1
        ELSE 0
    END) / COUNT(*)) * 100 AS discount_percentage
FROM
    customer
GROUP BY item_purchased
ORDER BY discount_percentage DESC
LIMIT 5;





-- Q7 : Segment customers into New, Returning and Loyal based on their total number of previous purchases,
-- and show the count of each segment.
WITH customer_type AS (
SELECT customer_id, previous_purchases,
CASE
	WHEN previous_purchases = 1 THEN 'New'
    WHEN previous_purchases BETWEEN 2 AND 10 THEN 'Returning'
    ELSE 'Loyal'
    END AS Customer_segment
FROM customer)

SELECT customer_segment, COUNT(*) AS 'Count of customers'
FROM customer_type
GROUP BY customer_segment;





-- Q8 : What are the Top 3 most purchased products within each category?
WITH item_count AS 
(
SELECT category, item_purchased,
COUNT(customer_id) AS total_orders,
ROW_NUMBER() OVER(PARTITION BY category ORDER BY COUNT(customer_id) DESC) AS item_rank
FROM customer
GROUP BY category, item_purchased
)

SELECT item_rank, category, item_purchased, total_orders
FROM item_count
WHERE item_rank <= 3;





-- Q9 : Are customers who are repeat buyers (more than 5 previous purchases) also likely to subscribe?
SELECT 
    subscription_status, COUNT(customer_id) AS repeat_buyers
FROM
    customer
WHERE
    previous_purchases > 5
GROUP BY subscription_status;





-- Q10 : What is the revenue contribution of each age group?
SELECT 
    age_group, SUM(purchase_amount) AS revenue
FROM
    customer
GROUP BY age_group
ORDER BY revenue DESC;